# HydroOJ AI å­¦ä¹ åŠ©æ‰‹ (@hydrooj/hydro-ai-helper)

ä¸€ä¸ªä»¥**æ•™å­¦ä¸ºä¼˜å…ˆ**çš„ AI è¾…åŠ©å­¦ä¹ æ’ä»¶ï¼Œå¸®åŠ©å­¦ç”Ÿåœ¨è§£é¢˜è¿‡ç¨‹ä¸­è·å¾—**æ€è·¯å¼•å¯¼**è€Œéç›´æ¥ç­”æ¡ˆã€‚æœ¬æ’ä»¶é€šè¿‡ AI å¯¹è¯çš„æ–¹å¼ï¼Œå¼•å¯¼å­¦ç”Ÿç†è§£é¢˜æ„ã€ç†æ¸…æ€è·¯ã€åˆ†æé”™è¯¯ï¼ŒåŒæ—¶ä¸ºæ•™å¸ˆæä¾›å¯¹è¯è®°å½•æŸ¥çœ‹ã€æ•°æ®å¯¼å‡ºå’Œç»Ÿè®¡åˆ†æåŠŸèƒ½ï¼Œæ”¯æŒæ•™å­¦ç ”ç©¶ã€‚

---

## ç›®å½•

- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [å®‰è£…è¯´æ˜](#å®‰è£…è¯´æ˜)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
  - [å­¦ç”Ÿä½¿ç”¨æŒ‡å—](#å­¦ç”Ÿä½¿ç”¨æŒ‡å—)
  - [æ•™å¸ˆä½¿ç”¨æŒ‡å—](#æ•™å¸ˆä½¿ç”¨æŒ‡å—)
  - [ç®¡ç†å‘˜ä½¿ç”¨æŒ‡å—](#ç®¡ç†å‘˜ä½¿ç”¨æŒ‡å—)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [å¼€å‘ä¸è°ƒè¯•](#å¼€å‘ä¸è°ƒè¯•)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [è®¸å¯è¯](#è®¸å¯è¯)

---

## æ ¸å¿ƒç‰¹æ€§

### ğŸ“š å­¦ç”Ÿç«¯ (Student)

- **æµ®åŠ¨å¯¹è¯é¢æ¿**ï¼šåœ¨é¢˜ç›®è¯¦æƒ…é¡µå³ä¸‹è§’æä¾›å¯æŠ˜å ã€å¯æ‹–æ‹½ã€å¯è°ƒæ•´å°ºå¯¸çš„ AI åŠ©æ‰‹é¢æ¿
- **æ™ºèƒ½é¢˜ç›®è¯»å–**ï¼šè‡ªåŠ¨ä»é¡µé¢ DOM æå–é¢˜ç›®æ ‡é¢˜å’Œæè¿°ï¼Œå‡å°‘æ‰‹åŠ¨è¾“å…¥
- **é—®é¢˜ç±»å‹å¼•å¯¼**ï¼šå¼ºåˆ¶å­¦ç”Ÿé€‰æ‹©é—®é¢˜ç±»å‹ï¼ˆç†è§£é¢˜æ„/ç†æ¸…æ€è·¯/åˆ†æé”™è¯¯/æ£€æŸ¥ä»£ç æ€è·¯ï¼‰å¹¶æè¿°æ€è·¯
- **å¯é€‰ä»£ç é™„å¸¦**ï¼šå­¦ç”Ÿå¯é€‰æ‹©æ€§é™„å¸¦ä»£ç ä¾› AI æ£€æŸ¥ï¼Œä»£ç é•¿åº¦è‡ªåŠ¨éªŒè¯å¹¶å®æ—¶åé¦ˆ
- **Markdown æ¸²æŸ“**ï¼šAI å›ç­”æ”¯æŒ Markdown æ ¼å¼ã€ä»£ç é«˜äº®ï¼ˆPython/C++/Java ç­‰ï¼‰ï¼Œé—®é¢˜å’Œå›å¤å‡å¯æ ¼å¼åŒ–æ˜¾ç¤º
- **å¤šè½®å¯¹è¯**ï¼šæ”¯æŒè¿ç»­æé—®ï¼ŒAI ä¼šå‚è€ƒå†å²å¯¹è¯ä¸Šä¸‹æ–‡ï¼ˆæœ€å¤šä¿ç•™æœ€è¿‘ 20 è½®ï¼‰
- **é¢‘ç‡é™åˆ¶æç¤º**ï¼šè¶…è¿‡é¢‘ç‡é™åˆ¶æ—¶æ˜¾ç¤ºå‹å¥½æç¤º"æé—®å¤ªé¢‘ç¹äº†ï¼Œè¯·ä»”ç»†æ€è€ƒåå†æé—®"

### ğŸ‘¨â€ğŸ« æ•™å¸ˆç«¯ (Teacher)

- **å¯¹è¯åˆ—è¡¨æŸ¥çœ‹**ï¼šæŸ¥çœ‹æ‰€æœ‰å­¦ç”Ÿçš„ AI å¯¹è¯è®°å½•ï¼Œæ”¯æŒæŒ‰æ—¶é—´èŒƒå›´ã€é¢˜ç›®ã€ç­çº§ã€å­¦ç”Ÿç­›é€‰
- **å¯¹è¯è¯¦æƒ…åˆ†æ**ï¼šæŸ¥çœ‹å®Œæ•´å¯¹è¯å†…å®¹ï¼ŒåŒ…å«å­¦ç”Ÿé—®é¢˜ç±»å‹ã€æ€è·¯æè¿°ã€æ˜¯å¦é™„å¸¦ä»£ç ç­‰å…ƒæ•°æ®
- **æ•°æ®å¯¼å‡º**ï¼šå¯¼å‡ºå¯¹è¯è®°å½•ä¸º CSV æ ¼å¼ï¼Œæ”¯æŒæ•°æ®è„±æ•é€‰é¡¹ï¼ˆåŒ¿ååŒ–å­¦ç”Ÿ IDï¼‰
- **ç»Ÿè®¡åˆ†æ**ï¼šæŒ‰ç­çº§/é¢˜ç›®/å­¦ç”Ÿç»´åº¦æŸ¥çœ‹ AI ä½¿ç”¨ç»Ÿè®¡ï¼ŒåŒ…æ‹¬æ€»å¯¹è¯æ•°ã€æœ‰æ•ˆå¯¹è¯å æ¯”ã€äººå‡ä½¿ç”¨æ¬¡æ•°ç­‰

### âš™ï¸ ç®¡ç†å‘˜ç«¯ (Admin)

- **AI æœåŠ¡é…ç½®**ï¼šé…ç½® API Base URLã€æ¨¡å‹åç§°ï¼ˆæ”¯æŒ OpenAI/Azure OpenAI ç­‰å…¼å®¹æœåŠ¡ï¼‰
- **API Key å®‰å…¨å­˜å‚¨**ï¼šAPI Key ä½¿ç”¨ AES-256-GCM åŠ å¯†å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œå‰ç«¯ä»…æ˜¾ç¤ºè„±æ•ç‰ˆæœ¬ï¼ˆå¦‚ `sk-****1234`ï¼‰
- **è¿æ¥æµ‹è¯•**ï¼šæä¾›"æµ‹è¯•è¿æ¥"æŒ‰é’®ï¼ŒéªŒè¯ AI æœåŠ¡é…ç½®æ˜¯å¦æ­£ç¡®
- **é¢‘ç‡é™åˆ¶é…ç½®**ï¼šè®¾ç½®æ¯ç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ¬¡æ•°ï¼ˆé»˜è®¤ 5 æ¬¡ï¼‰ï¼Œé˜²æ­¢æ»¥ç”¨å’Œæ§åˆ¶æˆæœ¬
- **System Prompt é…ç½®**ï¼šè‡ªå®šä¹‰ AI çš„ System Prompt æ¨¡æ¿ï¼Œç¡®ä¿ AI éµå¾ªæ•™å­¦åŸåˆ™

---

## å®‰è£…è¯´æ˜

### å‰ç½®è¦æ±‚

- **HydroOJ ç‰ˆæœ¬**ï¼š4.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Node.js ç‰ˆæœ¬**ï¼š18+ ï¼ˆç”¨äºæ„å»ºæ’ä»¶ï¼‰
- **MongoDB**ï¼šHydroOJ ä½¿ç”¨çš„æ•°æ®åº“ï¼ˆæ’ä»¶ä¼šè‡ªåŠ¨ä½¿ç”¨ HydroOJ çš„æ•°æ®åº“è¿æ¥ï¼‰

### å®‰è£…æ­¥éª¤

#### æ–¹å¼ä¸€ï¼šä»æœ¬åœ°ç›®å½•å®‰è£…ï¼ˆæ¨èï¼‰

1. **å…‹éš†ä»£ç ä»“åº“**

   ```bash
   git clone https://github.com/your-org/hydro-ai-helper.git
   cd hydro-ai-helper
   ```

2. **å®‰è£…ä¾èµ–**

   ```bash
   npm install
   ```

3. **ç¼–è¯‘ TypeScript**

   ```bash
   npm run build
   ```

   ç¼–è¯‘æˆåŠŸåï¼Œæ’ä»¶ä»£ç ä¼šè¾“å‡ºåˆ° `dist/` ç›®å½•ã€‚

4. **å°†æ’ä»¶åŠ å…¥ HydroOJ**

   ```bash
   hydrooj addon add /path/to/hydro-ai-helper
   ```

   > ğŸ’¡ æç¤ºï¼šå°† `/path/to/hydro-ai-helper` æ›¿æ¢ä¸ºä½ å®é™…çš„æ’ä»¶ç›®å½•è·¯å¾„ã€‚

5. **é‡å¯ HydroOJ**

   ```bash
   pm2 restart hydrooj
   ```

6. **éªŒè¯æ’ä»¶åŠ è½½**

   è®¿é—® `http://your-hydro-domain/ai-helper/hello`ï¼Œå¦‚æœè¿”å› JSON å“åº”ï¼ˆå¦‚ `{"message": "AI Helper Plugin Loaded", "version": "0.1.0"}`ï¼‰ï¼Œè¯´æ˜æ’ä»¶å·²æˆåŠŸåŠ è½½ã€‚

#### æ–¹å¼äºŒï¼šä» npm å®‰è£…ï¼ˆæœªæ¥æ”¯æŒï¼‰

```bash
hydrooj addon add @hydrooj/hydro-ai-helper
pm2 restart hydrooj
```

> âš ï¸ æ³¨æ„ï¼šæ­¤æ–¹å¼éœ€è¦æ’ä»¶å‘å¸ƒåˆ° npm ä»“åº“åæ‰å¯ç”¨ã€‚

---

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

æ’ä»¶éœ€è¦è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

#### `ENCRYPTION_KEY`ï¼ˆå¿…éœ€ï¼‰

ç”¨äºåŠ å¯†å­˜å‚¨ API Key çš„å¯†é’¥ï¼ˆAES-256-GCM åŠ å¯†ï¼‰ï¼Œå¿…é¡»ä¸º **32 å­—ç¬¦**çš„å­—ç¬¦ä¸²ã€‚

**è®¾ç½®æ–¹æ³•**ï¼š

åœ¨ HydroOJ çš„ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼ˆé€šå¸¸æ˜¯ `.env` æˆ–é€šè¿‡ PM2 é…ç½®ï¼‰ï¼š

```bash
# ç¤ºä¾‹ï¼ˆè¯·ä½¿ç”¨éšæœºç”Ÿæˆçš„ 32 å­—ç¬¦å¯†é’¥ï¼‰
export ENCRYPTION_KEY="your-32-character-secret-key!!!"
```

**ç”Ÿæˆéšæœºå¯†é’¥**ï¼ˆåœ¨ Linux/macOS ç»ˆç«¯è¿è¡Œï¼‰ï¼š

```bash
openssl rand -base64 24 | head -c 32
```

> âš ï¸ **å®‰å…¨æç¤º**ï¼š
> - ç”Ÿäº§ç¯å¢ƒè¯·åŠ¡å¿…ä½¿ç”¨éšæœºç”Ÿæˆçš„å¼ºå¯†é’¥ï¼Œä¸è¦ä½¿ç”¨ç¤ºä¾‹å¯†é’¥ã€‚
> - å¯†é’¥æ³„éœ²ä¼šå¯¼è‡´ API Key å¯è¢«è§£å¯†ï¼Œè¯·å¦¥å–„ä¿ç®¡ã€‚
> - æ›´æ¢å¯†é’¥åï¼Œå·²ä¿å­˜çš„ API Key å°†æ— æ³•è§£å¯†ï¼Œéœ€è¦é‡æ–°é…ç½®ã€‚

### ç®¡ç†å‘˜é…ç½®é¡µé¢

æ’ä»¶å®‰è£…å¹¶é‡å¯ HydroOJ åï¼Œç®¡ç†å‘˜éœ€è¦åœ¨åå°é…ç½® AI æœåŠ¡ï¼š

#### è®¿é—®é…ç½®é¡µé¢

1. ç™»å½• HydroOJ ç®¡ç†å‘˜è´¦å·
2. è¿›å…¥**æ§åˆ¶é¢æ¿** â†’ **AI é…ç½®**ï¼ˆæˆ–ç›´æ¥è®¿é—® `/ai-helper/admin/config`ï¼‰

#### é…ç½®å­—æ®µè¯´æ˜

| å­—æ®µåç§° | è¯´æ˜ | ç¤ºä¾‹ | å¿…éœ€ |
|---------|------|------|------|
| **API Base URL** | AI æœåŠ¡çš„ API åŸºç¡€ URL | `https://api.openai.com/v1` | âœ… |
| **æ¨¡å‹åç§°** | ä½¿ç”¨çš„æ¨¡å‹åç§° | `gpt-4` æˆ– `gpt-3.5-turbo` | âœ… |
| **API Key** | AI æœåŠ¡çš„ API å¯†é’¥ | `sk-...` | âœ… |
| **é¢‘ç‡é™åˆ¶ï¼ˆæ¯åˆ†é’Ÿï¼‰** | æ¯ç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ¬¡æ•° | `5`ï¼ˆé»˜è®¤ï¼‰ | âœ… |
| **è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰** | AI è¯·æ±‚è¶…æ—¶æ—¶é—´ | `30`ï¼ˆé»˜è®¤ï¼‰ | âœ… |
| **System Prompt æ¨¡æ¿** | AI çš„ç³»ç»Ÿæç¤ºè¯æ¨¡æ¿ | è§ä¸‹æ–¹è¯´æ˜ | âœ… |

#### é…ç½®å·¥ä½œæµç¨‹ç¤ºä¾‹

1. **å¡«å†™ API Base URL**

   - OpenAI å®˜æ–¹ï¼š`https://api.openai.com/v1`
   - Azure OpenAIï¼š`https://your-resource.openai.azure.com/openai/deployments/your-deployment-id`
   - ç¬¬ä¸‰æ–¹ä»£ç†æœåŠ¡ï¼šæ ¹æ®æœåŠ¡å•†æä¾›çš„ URL å¡«å†™

2. **é€‰æ‹©æ¨¡å‹åç§°**

   - æ¨èä½¿ç”¨ `gpt-4` æˆ– `gpt-3.5-turbo`ï¼ˆæˆæœ¬æ›´ä½ï¼‰
   - Azure OpenAI ç”¨æˆ·è¯·å¡«å†™éƒ¨ç½²çš„æ¨¡å‹åç§°

3. **å¡«å†™å¹¶ä¿å­˜ API Key**

   - API Key ä¼šè¢«åŠ å¯†å­˜å‚¨ï¼Œä¿å­˜åä»…æ˜¾ç¤ºè„±æ•ç‰ˆæœ¬ï¼ˆå¦‚ `sk-****1234`ï¼‰
   - å¦‚éœ€æ›´æ¢ API Keyï¼Œç›´æ¥å¡«å†™æ–°çš„å®Œæ•´ Key å¹¶ä¿å­˜

4. **é…ç½®é¢‘ç‡é™åˆ¶**

   - é»˜è®¤æ¯ç”¨æˆ·æ¯åˆ†é’Ÿ 5 æ¬¡è¯·æ±‚
   - å¯æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼ˆèŒƒå›´ 1-60ï¼‰

5. **ç‚¹å‡»"æµ‹è¯•è¿æ¥"**

   - ç³»ç»Ÿä¼šå‘é€ä¸€æ¡æµ‹è¯•æ¶ˆæ¯åˆ° AI æœåŠ¡
   - å¦‚æœè¿”å›"è¿æ¥æˆåŠŸ"ï¼Œè¯´æ˜é…ç½®æ­£ç¡®
   - å¦‚æœå¤±è´¥ï¼Œè¯·æ£€æŸ¥ API Base URLã€API Key æ˜¯å¦æ­£ç¡®ï¼Œä»¥åŠç½‘ç»œè¿æ¥

6. **ä¿å­˜é…ç½®**

   - ç‚¹å‡»"ä¿å­˜é…ç½®"æŒ‰é’®
   - ä¿å­˜æˆåŠŸåï¼Œå­¦ç”Ÿå³å¯ä½¿ç”¨ AI åŠ©æ‰‹åŠŸèƒ½

#### System Prompt æ¨¡æ¿è¯´æ˜

System Prompt æ¨¡æ¿ç”¨äºå®šä¹‰ AI çš„æ•™å­¦åŸåˆ™å’Œå›ç­”é£æ ¼ã€‚é»˜è®¤æ¨¡æ¿å¦‚ä¸‹ï¼š

```
ä½ æ˜¯ä¸€ä½è€å¿ƒçš„ç®—æ³•å­¦ä¹ å¯¼å¸ˆï¼Œå¸®åŠ©å­¦ç”Ÿç†è§£é¢˜æ„ã€ç†æ¸…æ€è·¯ã€å‘ç°é—®é¢˜ï¼Œä½†**ç¦æ­¢ç›´æ¥æä¾›å®Œæ•´çš„å¯æäº¤ä»£ç **ã€‚

æ•™å­¦åŸåˆ™ï¼š
1. å¼•å¯¼å¼å­¦ä¹ ï¼šé€šè¿‡æé—®å’Œæç¤ºå¼•å¯¼å­¦ç”Ÿæ€è€ƒï¼Œè€Œéç›´æ¥ç»™å‡ºç­”æ¡ˆ
2. æ€è·¯ä¼˜å…ˆï¼šé‡ç‚¹è®²è§£ç®—æ³•æ€è·¯ã€æ•°æ®ç»“æ„é€‰æ‹©ã€æ—¶é—´å¤æ‚åº¦åˆ†æ
3. ä»£ç ç‰‡æ®µå¼•å¯¼ï¼šå¯ä»¥æä¾›å…³é”®ä»£ç ç‰‡æ®µæˆ–ä¼ªä»£ç ï¼Œä½†ä¸èƒ½è¾“å‡ºå®Œæ•´å¯ç›´æ¥æäº¤çš„ä»£ç 
4. é¼“åŠ±å°è¯•ï¼šé¼“åŠ±å­¦ç”Ÿå°è¯•ä¸åŒæ€è·¯ï¼Œåˆ†æä¼˜ç¼ºç‚¹

å½“å‰é¢˜ç›®ï¼š{{problemTitle}}
```

ä½ å¯ä»¥æ ¹æ®å®é™…æ•™å­¦éœ€æ±‚ä¿®æ”¹æ­¤æ¨¡æ¿ï¼Œä½†è¯·ç¡®ä¿åŒ…å«"**ç¦æ­¢ç›´æ¥æä¾›å®Œæ•´ä»£ç **"çš„é˜²å¾¡æ€§è§„åˆ™ã€‚

---

## ä½¿ç”¨æŒ‡å—

### å­¦ç”Ÿä½¿ç”¨æŒ‡å—

#### 1. æ‰“å¼€ AI åŠ©æ‰‹é¢æ¿

- è®¿é—®ä»»æ„é¢˜ç›®è¯¦æƒ…é¡µï¼ˆå¦‚ `/p/P1000`ï¼‰
- é¡µé¢å³ä¸‹è§’ä¼šæ˜¾ç¤ºä¸€ä¸ªæŠ˜å çš„ AI åŠ©æ‰‹é¢æ¿ï¼ˆé»˜è®¤ä¸ºè“è‰²æˆ–ç´«è‰²ä¸»é¢˜è‰²æŒ‰é’®ï¼‰
- ç‚¹å‡»é¢æ¿æ ‡é¢˜æ æˆ–æŠ˜å æŒ‰é’®ï¼Œå±•å¼€å®Œæ•´å¯¹è¯æ¡†

#### 2. æŸ¥çœ‹é¢˜ç›®ä¿¡æ¯

- é¢æ¿ä¼šè‡ªåŠ¨è¯»å–å½“å‰é¢˜ç›®çš„æ ‡é¢˜å’Œç¼–å·ï¼ˆå¦‚ "ğŸ“ P1000: A+B Problem"ï¼‰
- å¦‚æœè‡ªåŠ¨è¯»å–å¤±è´¥ï¼Œä¼šæ˜¾ç¤ºæ‰‹åŠ¨è¾“å…¥æ¡†ï¼Œè¯·å¡«å†™é¢˜ç›®æ ‡é¢˜

#### 3. æäº¤é—®é¢˜

**å¿…å¡«å­—æ®µ**ï¼š

- **é—®é¢˜ç±»å‹**ï¼ˆå•é€‰ï¼‰ï¼š
  - ğŸ¤” ç†è§£é¢˜æ„ - æˆ‘å¯¹é¢˜ç›®è¦æ±‚ä¸å¤ªæ¸…æ¥š
  - ğŸ’¡ ç†æ¸…æ€è·¯ - æˆ‘éœ€è¦å¸®åŠ©æ¢³ç†è§£é¢˜æ€è·¯
  - ğŸ› åˆ†æé”™è¯¯ - æˆ‘çš„ä»£ç æœ‰é—®é¢˜ï¼Œéœ€è¦æ‰¾å‡ºåŸå› 
  - âœ… æ£€æŸ¥ä»£ç æ€è·¯ - è¯·å¸®æˆ‘æ£€æŸ¥æ€è·¯æ˜¯å¦æ­£ç¡®

- **æˆ‘çš„ç†è§£å’Œå°è¯•**ï¼ˆæ–‡æœ¬æ¡†ï¼Œè‡³å°‘ 20 å­—ï¼‰ï¼š
  - æè¿°ä½ å¯¹é¢˜ç›®çš„ç†è§£ã€å°è¯•è¿‡çš„æ€è·¯ã€é‡åˆ°çš„é—®é¢˜ç­‰
  - ç¤ºä¾‹ï¼š"æˆ‘è®¤ä¸ºè¿™é“é¢˜éœ€è¦ç”¨åŠ¨æ€è§„åˆ’ï¼Œä½†ä¸ç¡®å®šçŠ¶æ€å¦‚ä½•å®šä¹‰..."

**å¯é€‰å­—æ®µ**ï¼š

- **ğŸ“ é™„å¸¦å½“å‰ä»£ç ç»™ AI æ£€æŸ¥**ï¼ˆå¼€å…³æŒ‰é’®ï¼Œé»˜è®¤å…³é—­ï¼‰ï¼š
  - æ‰“å¼€å¼€å…³åï¼Œä¼šæ˜¾ç¤ºä»£ç è¾“å…¥æ¡†
  - æ‰‹åŠ¨å¤åˆ¶ç²˜è´´ä½ çš„ä»£ç åˆ°è¾“å…¥æ¡†
  - å®æ—¶æ˜¾ç¤ºä»£ç é•¿åº¦ï¼ˆè¶…è¿‡ 5000 å­—ç¬¦ä¼šæ˜¾ç¤ºè­¦å‘Šå¹¶è‡ªåŠ¨æˆªæ–­ï¼‰
  - å…³é—­å¼€å…³åï¼Œä»£ç ä¸ä¼šå‘é€ç»™ AIï¼ˆèŠ‚çœ token æˆæœ¬ï¼‰

#### 4. æŸ¥çœ‹ AI å›ç­”

- ç‚¹å‡»"å‘é€"æŒ‰é’®åï¼Œç­‰å¾… AI å›ç­”ï¼ˆé€šå¸¸ 3-10 ç§’ï¼‰
- AI å›ç­”ä¼šä»¥ Markdown æ ¼å¼æ˜¾ç¤ºï¼Œæ”¯æŒï¼š
  - ä»£ç å—é«˜äº®ï¼ˆPythonã€C++ã€Java ç­‰ï¼‰
  - åŠ ç²—ã€æ–œä½“ã€åˆ—è¡¨ã€å¼•ç”¨ç­‰æ ¼å¼
  - æ•°å­¦å…¬å¼ï¼ˆå¦‚æœ AI å›ç­”ä¸­åŒ…å« LaTeX å…¬å¼ï¼‰

- AI ä¼šæä¾›ï¼š
  - âœ… æ€è·¯å¼•å¯¼å’Œæç¤º
  - âœ… å…³é”®ä»£ç ç‰‡æ®µæˆ–ä¼ªä»£ç 
  - âœ… ç®—æ³•å¤æ‚åº¦åˆ†æ
  - âŒ **ä¸ä¼šæä¾›**å®Œæ•´å¯ç›´æ¥æäº¤çš„ä»£ç 

#### 5. å¤šè½®å¯¹è¯

- ä½ å¯ä»¥ç»§ç»­åœ¨åŒä¸€å¯¹è¯ä¸­æé—®ï¼ˆç‚¹å‡»"ç»§ç»­æé—®"æˆ–ç›´æ¥è¾“å…¥æ–°é—®é¢˜ï¼‰
- AI ä¼šå‚è€ƒä¹‹å‰çš„å¯¹è¯å†å²ï¼ˆæœ€å¤šä¿ç•™æœ€è¿‘ 20 è½®ï¼‰
- å¦‚éœ€å¼€å§‹æ–°è¯é¢˜ï¼Œå»ºè®®åˆ·æ–°é¡µé¢æˆ–å…³é—­åé‡æ–°æ‰“å¼€é¢æ¿

#### 6. æ³¨æ„äº‹é¡¹

- **é¢‘ç‡é™åˆ¶**ï¼šæ¯åˆ†é’Ÿæœ€å¤šæé—® 5 æ¬¡ï¼ˆå…·ä½“æ¬¡æ•°ç”±ç®¡ç†å‘˜é…ç½®ï¼‰ï¼Œè¶…è¿‡åä¼šæ˜¾ç¤º"æé—®å¤ªé¢‘ç¹äº†ï¼Œè¯·ä»”ç»†æ€è€ƒåå†æé—®"
- **ä»£ç éšç§**ï¼šä¸è¦é™„å¸¦ä¸é¢˜ç›®æ— å…³çš„æ•æ„Ÿä»£ç æˆ–ä¸ªäººä¿¡æ¯
- **æ€è€ƒä¼˜å…ˆ**ï¼šAI æ˜¯è¾…åŠ©å·¥å…·ï¼Œè¯·å…ˆç‹¬ç«‹æ€è€ƒå†æé—®ï¼Œé¿å…è¿‡åº¦ä¾èµ–

---

### æ•™å¸ˆä½¿ç”¨æŒ‡å—

#### 1. è®¿é—®å¯¹è¯åˆ—è¡¨é¡µ

- ç™»å½• HydroOJ æ•™å¸ˆæˆ–ç®¡ç†å‘˜è´¦å·
- è¿›å…¥**æ§åˆ¶é¢æ¿** â†’ **AI å¯¹è¯è®°å½•**ï¼ˆæˆ–ç›´æ¥è®¿é—® `/ai-helper/conversations`ï¼‰

#### 2. å¯¹è¯åˆ—è¡¨åŠŸèƒ½

**æ˜¾ç¤ºå­—æ®µ**ï¼š

- å­¦ç”Ÿ ID / å§“å
- ç­çº§
- é¢˜ç›®æ ‡é¢˜
- å¼€å§‹æ—¶é—´ / ç»“æŸæ—¶é—´
- æ¶ˆæ¯æ•°ï¼ˆå¯¹è¯è½®æ¬¡ï¼‰
- æœ‰æ•ˆå¯¹è¯æ ‡è®°ï¼ˆâœ“ æˆ– âœ—ï¼‰

**ç­›é€‰åŠŸèƒ½**ï¼š

- **æ—¶é—´èŒƒå›´**ï¼šé€‰æ‹©å¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸï¼ˆå¦‚ "2025-11-01" åˆ° "2025-11-30"ï¼‰
- **é¢˜ç›®ç­›é€‰**ï¼šè¾“å…¥é¢˜ç›® ID æˆ–æ ‡é¢˜å…³é”®è¯
- **ç­çº§ç­›é€‰**ï¼šé€‰æ‹©ç­çº§ï¼ˆä¸‹æ‹‰èœå•ï¼‰
- **å­¦ç”Ÿç­›é€‰**ï¼šè¾“å…¥å­¦ç”Ÿ ID æˆ–å§“å

**åˆ†é¡µåŠŸèƒ½**ï¼š

- æ¯é¡µé»˜è®¤æ˜¾ç¤º 50 æ¡è®°å½•
- ç‚¹å‡»"ä¸Šä¸€é¡µ" / "ä¸‹ä¸€é¡µ"æˆ–é¡µç åˆ‡æ¢é¡µé¢

#### 3. æŸ¥çœ‹å¯¹è¯è¯¦æƒ…

- ç‚¹å‡»åˆ—è¡¨ä¸­çš„ä»»æ„è®°å½•ï¼Œè¿›å…¥å¯¹è¯è¯¦æƒ…é¡µï¼ˆ`/ai-helper/conversations/{id}`ï¼‰
- å¯¹è¯è¯¦æƒ…é¡µæ˜¾ç¤ºï¼š
  - **ä¼šè¯å…ƒæ•°æ®**ï¼šå­¦ç”Ÿ IDã€ç­çº§ã€é¢˜ç›®ã€å¼€å§‹/ç»“æŸæ—¶é—´ã€æ¶ˆæ¯æ•°
  - **å®Œæ•´å¯¹è¯å†…å®¹**ï¼šå­¦ç”Ÿæ¶ˆæ¯å’Œ AI æ¶ˆæ¯ï¼ŒæŒ‰æ—¶é—´é¡ºåºæ’åˆ—
  - å­¦ç”Ÿæ¶ˆæ¯æ˜¾ç¤ºï¼šé—®é¢˜ç±»å‹ã€æ€è·¯æè¿°ã€æ˜¯å¦é™„å¸¦ä»£ç 
  - AI æ¶ˆæ¯ä»¥ Markdown æ ¼å¼æ¸²æŸ“ï¼ˆä»£ç å—é«˜äº®ï¼‰

#### 4. æ•°æ®å¯¼å‡º

**è®¿é—®å¯¼å‡ºå¯¹è¯æ¡†**ï¼š

- åœ¨å¯¹è¯åˆ—è¡¨é¡µï¼Œç‚¹å‡»"å¯¼å‡ºæ•°æ®"æŒ‰é’®
- å¼¹å‡ºå¯¼å‡ºé…ç½®å¯¹è¯æ¡†

**å¯¼å‡ºé€‰é¡¹**ï¼š

- **æ ¼å¼é€‰æ‹©**ï¼šCSVï¼ˆæœªæ¥å¯æ‰©å±• XLSXï¼‰
- **æ•°æ®ç±»å‹**ï¼šä¼šè¯çº§æ•°æ®ï¼ˆåŒ…å«ä¼šè¯ IDã€å­¦ç”Ÿ IDã€ç­çº§ã€é¢˜ç›®ã€æ—¶é—´ã€æ¶ˆæ¯æ•°ã€æœ‰æ•ˆå¯¹è¯æ ‡è®°ï¼‰
- **æ—¶é—´èŒƒå›´**ï¼šé€‰æ‹©å¯¼å‡ºæ•°æ®çš„æ—¶é—´èŒƒå›´ï¼ˆå¯é€‰ï¼‰
- **æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯**ï¼š
  - âœ… åŒ…å«ï¼šå¯¼å‡ºçœŸå®å­¦ç”Ÿ ID å’Œå§“å
  - âŒ ä¸åŒ…å«ï¼ˆé»˜è®¤ï¼‰ï¼šä½¿ç”¨åŒ¿å IDï¼ˆå¦‚ `student_123`ï¼‰

**ä¸‹è½½æ–‡ä»¶**ï¼š

- ç‚¹å‡»"ç¡®è®¤å¯¼å‡º"åï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä¸‹è½½ CSV æ–‡ä»¶
- æ–‡ä»¶åæ ¼å¼ï¼š`conversations_YYYYMMDD_HHMMSS.csv`

**ç¤ºä¾‹ curl å‘½ä»¤**ï¼ˆç›´æ¥è°ƒç”¨ APIï¼‰ï¼š

```bash
# ç¤ºä¾‹ 1ï¼šå¯¼å‡ºæ‰€æœ‰ä¼šè¯ï¼ˆè„±æ•ï¼‰
curl -X GET "http://127.0.0.1/ai-helper/export?format=csv" \
  -H "Cookie: sid=..." \
  --output conversations.csv

# ç¤ºä¾‹ 2ï¼šæŒ‰æ—¶é—´èŒƒå›´å’Œç­çº§ç­›é€‰ï¼ˆåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰
curl -X GET "http://127.0.0.1/ai-helper/export?format=csv&startDate=2025-11-01&endDate=2025-11-30&classId=class-101&includeSensitive=true" \
  -H "Cookie: sid=..." \
  --output conversations_class101_nov.csv

# ç¤ºä¾‹ 3ï¼šå¯¼å‡ºç‰¹å®šå­¦ç”Ÿçš„ä¼šè¯
curl -X GET "http://127.0.0.1/ai-helper/export?format=csv&userId=123" \
  -H "Cookie: sid=..." \
  --output conversations_user123.csv
```

#### 5. ç»Ÿè®¡åˆ†æ

**è®¿é—®ç»Ÿè®¡åˆ†æé¡µ**ï¼š

- è¿›å…¥**æ§åˆ¶é¢æ¿** â†’ **AI ä½¿ç”¨ç»Ÿè®¡**ï¼ˆæˆ–ç›´æ¥è®¿é—® `/ai-helper/analytics`ï¼‰

**ç»Ÿè®¡ç»´åº¦**ï¼š

- **æŒ‰ç­çº§ç»Ÿè®¡**ï¼šæ€»å¯¹è¯æ•°ã€äººå‡å¯¹è¯æ•°ã€æœ‰æ•ˆå¯¹è¯å æ¯”
- **æŒ‰é¢˜ç›®ç»Ÿè®¡**ï¼šä½¿ç”¨ AI äººæ•°ã€æ€»å¯¹è¯æ•°ã€å¹³å‡å¯¹è¯è½®æ¬¡ã€æœ‰æ•ˆå¯¹è¯å æ¯”
- **æŒ‰å­¦ç”Ÿç»Ÿè®¡**ï¼šæ€»å¯¹è¯æ•°ã€æœ€è¿‘ä½¿ç”¨æ—¶é—´ã€å¹³å‡å¯¹è¯è½®æ¬¡ã€æœ‰æ•ˆå¯¹è¯æ¯”ä¾‹

**ç­›é€‰é€‰é¡¹**ï¼š

- é€‰æ‹©ç»Ÿè®¡ç»´åº¦ï¼ˆå•é€‰ï¼šæŒ‰ç­çº§ / é¢˜ç›® / å­¦ç”Ÿï¼‰
- é€‰æ‹©æ—¶é—´èŒƒå›´ï¼ˆæ—¥æœŸé€‰æ‹©å™¨ï¼‰
- ç‚¹å‡»"æŸ¥è¯¢"æŒ‰é’®ï¼Œæ˜¾ç¤ºç»Ÿè®¡è¡¨æ ¼

**æ•°æ®å±•ç¤º**ï¼š

- ä»¥è¡¨æ ¼å½¢å¼æ¸…æ™°å±•ç¤ºç»Ÿè®¡æ•°æ®
- ï¼ˆå¯é€‰ï¼‰ä½¿ç”¨å›¾è¡¨å¯è§†åŒ–ï¼ˆå¦‚æŸ±çŠ¶å›¾ã€é¥¼å›¾ï¼‰

---

### ç®¡ç†å‘˜ä½¿ç”¨æŒ‡å—

#### 1. è®¿é—®é…ç½®é¡µé¢

- ç™»å½• HydroOJ ç®¡ç†å‘˜è´¦å·ï¼ˆå…·æœ‰ `PRIV.PRIV_EDIT_SYSTEM` æƒé™ï¼‰
- è¿›å…¥**æ§åˆ¶é¢æ¿** â†’ **AI é…ç½®**ï¼ˆæˆ–ç›´æ¥è®¿é—® `/ai-helper/admin/config`ï¼‰

#### 2. é…ç½®å·¥ä½œæµç¨‹

**æ­¥éª¤ 1ï¼šè®¾ç½® API Base URL å’Œæ¨¡å‹åç§°**

- å¡«å†™ AI æœåŠ¡çš„ API åŸºç¡€ URLï¼ˆå¦‚ `https://api.openai.com/v1`ï¼‰
- é€‰æ‹©æˆ–å¡«å†™æ¨¡å‹åç§°ï¼ˆå¦‚ `gpt-4` æˆ– `gpt-3.5-turbo`ï¼‰

**æ­¥éª¤ 2ï¼šå¡«å†™ API Key**

- åœ¨"API Key"è¾“å…¥æ¡†ä¸­å¡«å†™å®Œæ•´çš„ API Keyï¼ˆå¦‚ `sk-...`ï¼‰
- ç‚¹å‡»"æ˜¾ç¤º/éšè—"æŒ‰é’®å¯åˆ‡æ¢ API Key çš„æ˜æ–‡æ˜¾ç¤º
- ä¿å­˜åï¼ŒAPI Key ä¼šè¢«åŠ å¯†å­˜å‚¨ï¼Œé¡µé¢ä»…æ˜¾ç¤ºè„±æ•ç‰ˆæœ¬ï¼ˆå¦‚ `sk-****1234`ï¼‰

**æ­¥éª¤ 3ï¼šé…ç½®é¢‘ç‡é™åˆ¶**

- è®¾ç½®æ¯ç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ¬¡æ•°ï¼ˆé»˜è®¤ 5 æ¬¡ï¼ŒèŒƒå›´ 1-60ï¼‰
- æ­¤è®¾ç½®ç”¨äºé˜²æ­¢æ»¥ç”¨å’Œæ§åˆ¶ API è°ƒç”¨æˆæœ¬

**æ­¥éª¤ 4ï¼šæµ‹è¯•è¿æ¥**

- ç‚¹å‡»"æµ‹è¯•è¿æ¥"æŒ‰é’®
- ç³»ç»Ÿä¼šå‘é€ä¸€æ¡æµ‹è¯•æ¶ˆæ¯åˆ° AI æœåŠ¡ï¼ˆå†…å®¹ä¸º "Hello"ï¼‰
- å…¸å‹ç»“æœï¼š
  - âœ… **æˆåŠŸ**ï¼š"è¿æ¥æˆåŠŸï¼Œå»¶è¿Ÿ XXX ms"
  - âŒ **å¤±è´¥**ï¼š"è¿æ¥å¤±è´¥: API Key æ— æ•ˆ" æˆ– "è¿æ¥å¤±è´¥: ç½‘ç»œè¶…æ—¶"

**æ­¥éª¤ 5ï¼šä¿å­˜é…ç½®**

- ç‚¹å‡»"ä¿å­˜é…ç½®"æŒ‰é’®
- ä¿å­˜æˆåŠŸåï¼Œç³»ç»Ÿä¼šæ˜¾ç¤º"é…ç½®å·²ä¿å­˜"æç¤º
- å­¦ç”Ÿå³å¯å¼€å§‹ä½¿ç”¨ AI åŠ©æ‰‹åŠŸèƒ½

#### 3. æƒé™è¯´æ˜

- **é…ç½®é¡µé¢è®¿é—®æƒé™**ï¼šéœ€è¦ `PRIV.PRIV_EDIT_SYSTEM`ï¼ˆç³»ç»Ÿç®¡ç†å‘˜æƒé™ï¼‰
- **å¯¹è¯è®°å½•æŸ¥çœ‹æƒé™**ï¼šéœ€è¦ `PRIV.PRIV_EDIT_SYSTEM`ï¼ˆç›®å‰ä»… root ç”¨æˆ·å¯è®¿é—®ï¼Œæœªæ¥å¯æ‰©å±•ä¸ºæ•™å¸ˆæƒé™ï¼‰

#### 4. å®‰å…¨ç®¡ç†

- **API Key å­˜å‚¨**ï¼šAPI Key ä½¿ç”¨ AES-256-GCM åŠ å¯†å­˜å‚¨åœ¨ MongoDB æ•°æ®åº“ä¸­
- **ç¯å¢ƒå˜é‡ `ENCRYPTION_KEY`**ï¼šå¿…é¡»è®¾ç½® 32 å­—ç¬¦çš„åŠ å¯†å¯†é’¥ï¼ˆè§ä¸Šæ–¹"é…ç½®è¯´æ˜"ç« èŠ‚ï¼‰
- **API Key è½®æ¢**ï¼šå¦‚éœ€æ›´æ¢ API Keyï¼Œç›´æ¥åœ¨é…ç½®é¡µé¢å¡«å†™æ–°çš„ Key å¹¶ä¿å­˜å³å¯

---

## å¸¸è§é—®é¢˜

### 1. æ’ä»¶å®‰è£…åé¡µé¢æ²¡æœ‰å‡ºç° AI é¢æ¿æ€ä¹ˆåŠï¼Ÿ

**å¯èƒ½åŸå› åŠè§£å†³æ–¹æ³•**ï¼š

- **æ’ä»¶æœªæ­£ç¡®åŠ è½½**ï¼š
  - æ£€æŸ¥ `pm2 logs hydrooj` ä¸­æ˜¯å¦æœ‰ `[AI Helper] Plugin loaded successfully` æ—¥å¿—
  - å¦‚æœæ²¡æœ‰ï¼Œå°è¯•é‡æ–°è¿è¡Œ `hydrooj addon add /path/to/hydro-ai-helper` å¹¶é‡å¯ `pm2 restart hydrooj`

- **å‰ç«¯è„šæœ¬æœªç¼–è¯‘æˆ–æœªåŠ è½½**ï¼š
  - ç¡®è®¤ `npm run build` ç¼–è¯‘æˆåŠŸï¼Œ`dist/` ç›®å½•ä¸‹æœ‰ `index.js` ç­‰æ–‡ä»¶
  - æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶åˆ·æ–°é¡µé¢ï¼ˆCtrl+Shift+R æˆ– Cmd+Shift+Rï¼‰

- **é¢˜ç›®é¡µé¢è·¯å¾„ä¸åŒ¹é…**ï¼š
  - é¢æ¿ä»…åœ¨é¢˜ç›®è¯¦æƒ…é¡µæ˜¾ç¤ºï¼ˆURL æ ¼å¼ä¸º `/p/{problemId}`ï¼‰
  - å¦‚æœåœ¨å…¶ä»–é¡µé¢ï¼ˆå¦‚é¦–é¡µã€é¢˜ç›®åˆ—è¡¨ï¼‰ï¼ŒAI é¢æ¿ä¸ä¼šæ˜¾ç¤º

### 2. æµ‹è¯•è¿æ¥å¤±è´¥ / AI æ— å“åº”æ€ä¹ˆåŠï¼Ÿ

**å¯èƒ½åŸå› åŠè§£å†³æ–¹æ³•**ï¼š

- **API Base URL é”™è¯¯**ï¼š
  - ç¡®è®¤ URL æ ¼å¼æ­£ç¡®ï¼ˆå¦‚ `https://api.openai.com/v1`ï¼Œæ³¨æ„ç»“å°¾**ä¸è¦**å¸¦ `/chat/completions`ï¼‰
  - Azure OpenAI ç”¨æˆ·è¯·ç¡®è®¤ URL åŒ…å« deployment ID

- **API Key æ— æ•ˆ**ï¼š
  - ç¡®è®¤ API Key æ ¼å¼æ­£ç¡®ï¼ˆOpenAI æ ¼å¼ä¸º `sk-...`ï¼‰
  - æ£€æŸ¥ API Key æ˜¯å¦æœ‰æ•ˆï¼ˆæœªè¿‡æœŸã€æœªè¢«ç¦ç”¨ï¼‰
  - è®¿é—® OpenAI æ§åˆ¶å°ç¡®è®¤ API Key çŠ¶æ€

- **ç½‘ç»œè¿æ¥é—®é¢˜**ï¼š
  - æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦èƒ½è®¿é—® OpenAI APIï¼ˆåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ `curl https://api.openai.com/v1/models -H "Authorization: Bearer YOUR_API_KEY"`ï¼‰
  - å¦‚æœåœ¨ä¸­å›½å¤§é™†ï¼Œå¯èƒ½éœ€è¦é…ç½®ä»£ç†æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹ä»£ç†æœåŠ¡

- **é˜²ç«å¢™æˆ–ä»£ç†é—®é¢˜**ï¼š
  - æ£€æŸ¥æœåŠ¡å™¨é˜²ç«å¢™æ˜¯å¦æ‹¦æˆªäº†å‡ºç«™ HTTPS è¯·æ±‚
  - å¦‚ä½¿ç”¨ä»£ç†ï¼Œç¡®è®¤ä»£ç†é…ç½®æ­£ç¡®

### 3. æäº¤è¯·æ±‚æç¤ºé¢‘ç‡é™åˆ¶ / 429 é”™è¯¯æ€ä¹ˆåŠï¼Ÿ

**å¯èƒ½åŸå› åŠè§£å†³æ–¹æ³•**ï¼š

- **è¶…è¿‡é¢‘ç‡é™åˆ¶**ï¼š
  - é»˜è®¤æ¯ç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤š 5 æ¬¡è¯·æ±‚ï¼ˆç®¡ç†å‘˜å¯åœ¨é…ç½®é¡µé¢è°ƒæ•´ï¼‰
  - å­¦ç”Ÿç«¯ä¼šæ˜¾ç¤º"æé—®å¤ªé¢‘ç¹äº†ï¼Œè¯·ä»”ç»†æ€è€ƒåå†æé—®"
  - ç­‰å¾… 1 åˆ†é’Ÿåé‡è¯•

- **é¢‘ç‡é™åˆ¶è®¾ç½®è¿‡ä½**ï¼š
  - ç®¡ç†å‘˜å¯ä»¥åœ¨é…ç½®é¡µé¢è°ƒé«˜é¢‘ç‡é™åˆ¶ï¼ˆå¦‚æ”¹ä¸º 10 æ¬¡/åˆ†é’Ÿï¼‰
  - æ³¨æ„ï¼šè¿‡é«˜çš„é¢‘ç‡é™åˆ¶å¯èƒ½å¯¼è‡´ API æˆæœ¬å¢åŠ 

### 4. æ•™å¸ˆç«¯çœ‹ä¸åˆ°ä»»ä½•å¯¹è¯è®°å½•å¯èƒ½æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ

**å¯èƒ½åŸå› åŠè§£å†³æ–¹æ³•**ï¼š

- **æ— å­¦ç”Ÿä½¿ç”¨**ï¼š
  - ç¡®è®¤å­¦ç”Ÿæ˜¯å¦å·²ç»ä½¿ç”¨ AI åŠ©æ‰‹æé—®
  - æ£€æŸ¥æ•°æ®åº“ä¸­ `conversations` é›†åˆæ˜¯å¦æœ‰è®°å½•ï¼ˆä½¿ç”¨ MongoDB å®¢æˆ·ç«¯æŸ¥è¯¢ï¼‰

- **æƒé™ä¸è¶³**ï¼š
  - ç›®å‰å¯¹è¯è®°å½•æŸ¥çœ‹éœ€è¦ `PRIV.PRIV_EDIT_SYSTEM` æƒé™ï¼ˆä»… root ç”¨æˆ·ï¼‰
  - æœªæ¥ç‰ˆæœ¬å¯èƒ½ä¼šæ‰©å±•ä¸ºæ•™å¸ˆæƒé™ï¼Œæ”¯æŒæ•™å¸ˆæŸ¥çœ‹æ‰€è´Ÿè´£ç­çº§çš„å¯¹è¯è®°å½•

- **æ—¶é—´è¿‡æ»¤æ¡ä»¶ä¸å½“**ï¼š
  - æ£€æŸ¥æ—¶é—´èŒƒå›´ç­›é€‰æ˜¯å¦è¿‡çª„ï¼ˆå¦‚åªé€‰æ‹©äº†ä»Šå¤©ï¼Œä½†å­¦ç”Ÿä½¿ç”¨æ—¶é—´åœ¨æ˜¨å¤©ï¼‰
  - å°è¯•æ¸…é™¤ç­›é€‰æ¡ä»¶ï¼ŒæŸ¥çœ‹å…¨éƒ¨è®°å½•

### 5. å¦‚ä½•åœ¨æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¸­åˆ†åˆ«é…ç½®ä¸åŒçš„æ¨¡å‹å’Œ Keyï¼Ÿ

**è§£å†³æ–¹æ³•**ï¼š

- **ä½¿ç”¨ä¸åŒçš„ç¯å¢ƒå˜é‡**ï¼š
  - åœ¨æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒåˆ†åˆ«è®¾ç½® `ENCRYPTION_KEY` ç¯å¢ƒå˜é‡
  - åœ¨ç®¡ç†å‘˜é…ç½®é¡µé¢ä¸ºä¸åŒç¯å¢ƒé…ç½®ä¸åŒçš„ API Base URLã€æ¨¡å‹å’Œ API Key

- **ä½¿ç”¨é…ç½®æ–‡ä»¶**ï¼š
  - åœ¨ä¸åŒç¯å¢ƒçš„æœåŠ¡å™¨ä¸Šï¼Œæ‰‹åŠ¨ç™»å½•ç®¡ç†å‘˜é…ç½®é¡µé¢ï¼Œåˆ†åˆ«é…ç½®ä¸åŒçš„ API æœåŠ¡
  - é…ç½®æ•°æ®å­˜å‚¨åœ¨ MongoDB çš„ `aiConfig` é›†åˆä¸­ï¼Œä¸åŒç¯å¢ƒçš„æ•°æ®åº“äº’ç›¸ç‹¬ç«‹

### 6. å¦‚ä½•å®‰å…¨åœ°è½®æ¢/æ›´æ¢ API Keyï¼Ÿ

**æ­¥éª¤**ï¼š

1. **å‡†å¤‡æ–°çš„ API Key**ï¼š
   - åœ¨ OpenAI æ§åˆ¶å°ç”Ÿæˆæ–°çš„ API Key

2. **åœ¨é…ç½®é¡µé¢æ›´æ–° API Key**ï¼š
   - ç™»å½•ç®¡ç†å‘˜é…ç½®é¡µé¢
   - åœ¨"API Key"è¾“å…¥æ¡†ä¸­å¡«å†™æ–°çš„å®Œæ•´ API Key
   - ç‚¹å‡»"æµ‹è¯•è¿æ¥"ç¡®è®¤æ–° Key å¯ç”¨
   - ç‚¹å‡»"ä¿å­˜é…ç½®"

3. **åˆ é™¤æ—§çš„ API Key**ï¼š
   - åœ¨ OpenAI æ§åˆ¶å°åˆ é™¤æˆ–ç¦ç”¨æ—§çš„ API Key

4. **éªŒè¯åŠŸèƒ½æ­£å¸¸**ï¼š
   - è®©å­¦ç”Ÿæµ‹è¯• AI åŠ©æ‰‹åŠŸèƒ½ï¼Œç¡®è®¤èƒ½æ­£å¸¸ä½¿ç”¨

> ğŸ’¡ æç¤ºï¼šæ›´æ¢ API Key æ—¶ï¼Œæ—§çš„ Key ä¼šè¢«è¦†ç›–ï¼Œæ— éœ€æ‹…å¿ƒæ•°æ®æ®‹ç•™ã€‚

### 7. AI å›ç­”è´¨é‡ä¸ç¨³å®šï¼Œæœ‰æ—¶ç»™å‡ºæ— å…³å›ç­”æˆ–è¿‡äºè¯¦ç»†çš„ä»£ç æ€ä¹ˆåŠï¼Ÿ

**å¯èƒ½åŸå› åŠè§£å†³æ–¹æ³•**ï¼š

- **System Prompt ä¸å¤Ÿä¸¥æ ¼**ï¼š
  - åœ¨ç®¡ç†å‘˜é…ç½®é¡µé¢ä¿®æ”¹ System Prompt æ¨¡æ¿ï¼Œå¼ºåŒ–"ç¦æ­¢æä¾›å®Œæ•´ä»£ç "çš„è§„åˆ™
  - å‚è€ƒç¤ºä¾‹æ¨¡æ¿ï¼ˆè§ä¸Šæ–¹"é…ç½®è¯´æ˜"ç« èŠ‚ï¼‰

- **å­¦ç”Ÿè¾“å…¥ä¸å¤Ÿæ¸…æ™°**ï¼š
  - å¼•å¯¼å­¦ç”Ÿæ›´æ¸…æ™°åœ°æè¿°é—®é¢˜å’Œæ€è·¯ï¼ˆè‡³å°‘ 20 å­—ï¼‰
  - é¿å…è¿‡äºç®€çŸ­çš„æé—®ï¼ˆå¦‚"æ€ä¹ˆåš"ï¼‰

- **æ¨¡å‹éšæœºæ€§**ï¼š
  - AI æ¨¡å‹æœ¬èº«å­˜åœ¨ä¸€å®šéšæœºæ€§ï¼ˆtemperature å‚æ•°æ§åˆ¶ï¼‰
  - ç›®å‰æ’ä»¶ä½¿ç”¨ `temperature=0.7`ï¼Œå¦‚éœ€æ›´ç¨³å®šçš„å›ç­”ï¼Œå¯åœ¨ä»£ç ä¸­è°ƒä½æ­¤å‚æ•°ï¼ˆå¦‚ `0.5`ï¼‰

- **æä¾›"é‡æ–°ç”Ÿæˆ"åŠŸèƒ½**ï¼ˆæœªæ¥ç‰ˆæœ¬ï¼‰ï¼š
  - å¦‚æœ AI å›ç­”è´¨é‡ä¸ä½³ï¼Œå­¦ç”Ÿå¯ä»¥ç‚¹å‡»"é‡æ–°ç”Ÿæˆ"æŒ‰é’®é‡æ–°æé—®

### 8. å¦‚ä½•æŸ¥çœ‹æ’ä»¶çš„æ—¥å¿—å’Œè°ƒè¯•ä¿¡æ¯ï¼Ÿ

**æŸ¥çœ‹æ—¥å¿—**ï¼š

```bash
# æŸ¥çœ‹ HydroOJ æ—¥å¿—ï¼ˆåŒ…å«æ’ä»¶æ—¥å¿—ï¼‰
pm2 logs hydrooj

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
pm2 logs hydrooj --lines 100

# å®æ—¶ç›‘æ§æ—¥å¿—
pm2 logs hydrooj --follow
```

**å…³é”®æ—¥å¿—æ ‡è®°**ï¼š

- `[AI Helper]`ï¼šæ’ä»¶ç›¸å…³æ—¥å¿—
- `[ChatHandler]`ï¼šå­¦ç”Ÿç«¯å¯¹è¯ API æ—¥å¿—
- `[ConversationListHandler]`ï¼šæ•™å¸ˆç«¯å¯¹è¯åˆ—è¡¨ API æ—¥å¿—
- `[AdminConfigHandler]`ï¼šç®¡ç†å‘˜é…ç½® API æ—¥å¿—

---

## å¼€å‘ä¸è°ƒè¯•

æœ¬èŠ‚é¢å‘å¼€å‘è€…ï¼Œä»‹ç»å¦‚ä½•åœ¨æœ¬åœ°å¼€å‘å’Œè°ƒè¯•æ’ä»¶ã€‚

### æœ¬åœ°å¼€å‘ç¯å¢ƒæ­å»º

**å‰ç½®è¦æ±‚**ï¼š

- Node.js 18+
- HydroOJ å¼€å‘ç¯å¢ƒï¼ˆå‚è€ƒ [HydroOJ å®˜æ–¹æ–‡æ¡£](https://hydro.js.org/docs/)ï¼‰
- MongoDBï¼ˆå¯ä½¿ç”¨æœ¬åœ°å®‰è£…æˆ– Dockerï¼‰

**æ­¥éª¤**ï¼š

1. **å…‹éš†ä»£ç ä»“åº“**

   ```bash
   git clone https://github.com/your-org/hydro-ai-helper.git
   cd hydro-ai-helper
   ```

2. **å®‰è£…ä¾èµ–**

   ```bash
   npm install
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**

   åˆ›å»º `.env` æ–‡ä»¶ï¼ˆä»…ç”¨äºå¼€å‘ç¯å¢ƒï¼‰ï¼š

   ```bash
   ENCRYPTION_KEY="dev-32-character-key-for-test!"
   ```

4. **å¯åŠ¨å¼€å‘æ¨¡å¼**

   ```bash
   npm run dev
   ```

   æ­¤å‘½ä»¤ä¼šå¯åŠ¨ TypeScript çš„ watch æ¨¡å¼ï¼Œæ–‡ä»¶ä¿®æ”¹åè‡ªåŠ¨é‡æ–°ç¼–è¯‘ã€‚

5. **åœ¨ HydroOJ ä¸­åŠ è½½æ’ä»¶**

   ```bash
   hydrooj addon add /path/to/hydro-ai-helper
   pm2 restart hydrooj
   ```

6. **è°ƒè¯•å‰ç«¯ä»£ç **

   - å‰ç«¯ä»£ç åœ¨æµè§ˆå™¨ä¸­è°ƒè¯•ï¼Œä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
   - ä¿®æ”¹ `frontend/` ä¸‹çš„æ–‡ä»¶åï¼Œéœ€è¦é‡æ–°è¿è¡Œ `npm run build` å¹¶åˆ·æ–°æµè§ˆå™¨

### è¿è¡Œæµ‹è¯•

**å•å…ƒæµ‹è¯•**ï¼ˆæœªæ¥æ”¯æŒï¼‰ï¼š

```bash
npm test
```

**é›†æˆæµ‹è¯•**ï¼ˆæ‰‹åŠ¨æ‰§è¡Œï¼‰ï¼š

- å‚è€ƒ `.specify/specs/ai-learning-assistant/tasks.md` ä¸­çš„ T026 ä»»åŠ¡
- ä½¿ç”¨ Postman æˆ– curl æµ‹è¯•å„ä¸ª API ç«¯ç‚¹ï¼›è¯¦è§ `tests/integration/README.md` è·å–å¯æ‰§è¡Œè„šæœ¬ä¸è¯´æ˜

### æ€§èƒ½æµ‹è¯• (Performance Testing)

- `tests/performance/README.md` æä¾›äº†å‹æµ‹å‡†å¤‡ã€k6 è„šæœ¬ç¤ºä¾‹ä¸ç›®æ ‡å€¼ï¼Œå»ºè®®åœ¨ç‹¬ç«‹çš„æµ‹è¯•ç¯å¢ƒè¿è¡Œ
- é‡ç‚¹å…³æ³¨ `/ai-helper/chat`ã€`/ai-helper/conversations`ã€`/ai-helper/export` ç­‰é«˜é¢‘æ¥å£çš„ P95 è€—æ—¶

### ä»£ç é£æ ¼æ£€æŸ¥

```bash
npm run lint
```

### è¯¦ç»†å¼€å‘æ–‡æ¡£

æ›´å¤šå¼€å‘ç»†èŠ‚è¯·å‚è€ƒï¼š

- [é¡¹ç›®è®¾è®¡æ–‡æ¡£](.specify/specs/ai-learning-assistant/plan.md)
- [ä»»åŠ¡åˆ†è§£](.specify/specs/ai-learning-assistant/tasks.md)

---

## é¡¹ç›®ç»“æ„

```
hydro-ai-helper/
â”œâ”€â”€ src/                       # åç«¯æºç ï¼ˆTypeScriptï¼‰
â”‚   â”œâ”€â”€ index.ts               # æ’ä»¶å…¥å£ï¼Œæ³¨å†Œè·¯ç”±å’Œæ•°æ®åº“æ¨¡å‹
â”‚   â”œâ”€â”€ models/                # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ conversation.ts    # å¯¹è¯è®°å½•æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ message.ts         # æ¶ˆæ¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ aiConfig.ts        # AI é…ç½®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ rateLimitRecord.ts # é¢‘ç‡é™åˆ¶è®°å½•æ¨¡å‹
â”‚   â”œâ”€â”€ services/              # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ openaiClient.ts    # OpenAI API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ promptService.ts   # Prompt æ„é€ æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ conversationService.ts # å¯¹è¯ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ rateLimitService.ts    # é¢‘ç‡é™åˆ¶æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ effectivenessService.ts # æœ‰æ•ˆå¯¹è¯åˆ¤å®šæœåŠ¡
â”‚   â”‚   â””â”€â”€ exportService.ts   # æ•°æ®å¯¼å‡ºæœåŠ¡
â”‚   â”œâ”€â”€ handlers/              # è·¯ç”±å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ testHandler.ts     # æµ‹è¯•è·¯ç”±ï¼ˆGET /ai-helper/helloï¼‰
â”‚   â”‚   â”œâ”€â”€ studentHandler.ts  # å­¦ç”Ÿç«¯å¯¹è¯ APIï¼ˆPOST /ai-helper/chatï¼‰
â”‚   â”‚   â”œâ”€â”€ teacherHandler.ts  # æ•™å¸ˆç«¯å¯¹è¯åˆ—è¡¨/è¯¦æƒ… API
â”‚   â”‚   â”œâ”€â”€ analyticsHandler.ts # ç»Ÿè®¡åˆ†æ API
â”‚   â”‚   â”œâ”€â”€ exportHandler.ts   # æ•°æ®å¯¼å‡º API
â”‚   â”‚   â”œâ”€â”€ adminHandler.ts    # ç®¡ç†å‘˜é…ç½® API
â”‚   â”‚   â””â”€â”€ adminConfigHandler.ts # ç®¡ç†å‘˜é…ç½®é¡µé¢ Handler
â”‚   â”œâ”€â”€ lib/                   # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ crypto.ts          # API Key åŠ å¯†/è§£å¯†å·¥å…·
â”‚   â”‚   â””â”€â”€ validation.ts      # è¾“å…¥éªŒè¯å·¥å…·ï¼ˆæœªæ¥æ‰©å±•ï¼‰
â”‚   â””â”€â”€ constants.ts           # å¸¸é‡å®šä¹‰
â”‚
â”œâ”€â”€ frontend/                  # å‰ç«¯æºç ï¼ˆReact + TypeScriptï¼‰
â”‚   â”œâ”€â”€ problem_detail.page.tsx        # é¢˜ç›®è¯¦æƒ…é¡µè„šæœ¬ï¼ˆæŒ‚è½½ AI é¢æ¿ï¼‰
â”‚   â”œâ”€â”€ student/               # å­¦ç”Ÿç«¯ç»„ä»¶
â”‚   â”‚   â””â”€â”€ AIAssistantPanel.tsx # AI åŠ©æ‰‹é¢æ¿ï¼ˆæµ®åŠ¨å¯¹è¯æ¡†ï¼‰
â”‚   â”œâ”€â”€ teacher/               # æ•™å¸ˆç«¯ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ConversationList.tsx   # å¯¹è¯åˆ—è¡¨é¡µ
â”‚   â”‚   â”œâ”€â”€ ConversationDetail.tsx # å¯¹è¯è¯¦æƒ…é¡µ
â”‚   â”‚   â”œâ”€â”€ ExportDialog.tsx       # å¯¼å‡ºå¯¹è¯æ¡†
â”‚   â”‚   â””â”€â”€ AnalyticsPage.tsx      # ç»Ÿè®¡åˆ†æé¡µ
â”‚   â”œâ”€â”€ admin/                 # ç®¡ç†å‘˜ç«¯ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ConfigPanel.tsx    # é…ç½®é¢æ¿
â”‚   â”œâ”€â”€ ai_helper_conversations.page.tsx # å¯¹è¯åˆ—è¡¨é¡µé¢è·¯ç”±
â”‚   â”œâ”€â”€ ai_helper_conversation_detail.page.tsx # å¯¹è¯è¯¦æƒ…é¡µé¢è·¯ç”±
â”‚   â”œâ”€â”€ ai_helper_analytics.page.tsx # ç»Ÿè®¡åˆ†æé¡µé¢è·¯ç”±
â”‚   â””â”€â”€ ai_helper_admin_config.page.tsx # ç®¡ç†å‘˜é…ç½®é¡µé¢è·¯ç”±
â”‚
â”œâ”€â”€ dist/                      # ç¼–è¯‘è¾“å‡ºç›®å½•ï¼ˆnpm run build ç”Ÿæˆï¼‰
â”œâ”€â”€ public/                    # é™æ€èµ„æºï¼ˆå›¾æ ‡ç­‰ï¼Œå¯é€‰ï¼‰
â”œâ”€â”€ locales/                   # å¤šè¯­è¨€æ–‡ä»¶ï¼ˆæœªæ¥æ”¯æŒï¼‰
â”œâ”€â”€ .specify/                  # è®¾è®¡æ–‡æ¡£å’Œè§„æ ¼è¯´æ˜
â”‚   â””â”€â”€ specs/ai-learning-assistant/
â”‚       â”œâ”€â”€ plan.md            # å®ç°è®¡åˆ’
â”‚       â”œâ”€â”€ tasks.md           # ä»»åŠ¡åˆ†è§£
â”‚       â””â”€â”€ ...
â”œâ”€â”€ package.json               # npm é…ç½®å’Œä¾èµ–
â”œâ”€â”€ tsconfig.json              # TypeScript é…ç½®
â”œâ”€â”€ README.md                  # æœ¬æ–‡æ¡£
â””â”€â”€ LICENSE                    # è®¸å¯è¯ï¼ˆMITï¼‰
```

---

## æŠ€æœ¯æ¶æ„

- **åç«¯**ï¼šTypeScript + HydroOJ Plugin API
- **æ•°æ®åº“**ï¼šMongoDBï¼ˆé€šè¿‡ HydroOJ æä¾›çš„ `ctx.db` è®¿é—®ï¼‰
- **å‰ç«¯**ï¼šReact 17+ + Markdown-it + Highlight.js
- **AI æœåŠ¡**ï¼šOpenAI å…¼å®¹ APIï¼ˆæ”¯æŒ OpenAI / Azure OpenAI / ç¬¬ä¸‰æ–¹ä»£ç†ï¼‰
- **åŠ å¯†**ï¼šAES-256-GCMï¼ˆNode.js `crypto` æ¨¡å—ï¼‰

---

## æ•™å­¦åŸåˆ™

æœ¬æ’ä»¶ä¸¥æ ¼éµå¾ªä»¥ä¸‹æ•™å­¦åŸåˆ™ï¼š

1. **å¼•å¯¼å¼å­¦ä¹ **ï¼šAI ä¸ä¼šæä¾›å®Œæ•´çš„å¯æäº¤ä»£ç ï¼Œä»…æä¾›æ€è·¯ã€ä¼ªä»£ç å’Œå…³é”®ä»£ç ç‰‡æ®µ
2. **å¼ºåˆ¶æ€è€ƒ**ï¼šå­¦ç”Ÿå¿…é¡»å…ˆæè¿°è‡ªå·±çš„ç†è§£å’Œå°è¯•ï¼ˆè‡³å°‘ 20 å­—ï¼‰ï¼Œæ‰èƒ½æäº¤é—®é¢˜
3. **è¿‡ç¨‹å¯è¿½æº¯**ï¼šæ‰€æœ‰å¯¹è¯è®°å½•ä¿å­˜åˆ°æ•°æ®åº“ï¼Œæ•™å¸ˆå¯æŸ¥çœ‹å’Œåˆ†æ
4. **éšç§ä¿æŠ¤**ï¼šAPI Key æœåŠ¡ç«¯åŠ å¯†å­˜å‚¨ï¼Œå‰ç«¯ä»£ç å’Œç½‘ç»œè¯·æ±‚ä¸­ä¸åŒ…å«ä»»ä½•å‡­è¯

---

## è®¸å¯è¯

MIT License

ç‰ˆæƒæ‰€æœ‰ (c) 2025 HydroOJ AI å­¦ä¹ åŠ©æ‰‹å¼€å‘å›¢é˜Ÿ

è¯¦ç»†è®¸å¯è¯å†…å®¹è¯·å‚è€ƒ [LICENSE](./LICENSE) æ–‡ä»¶ã€‚

---

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

å¦‚éœ€è´¡çŒ®ä»£ç æˆ–åé¦ˆé—®é¢˜ï¼Œè¯·è®¿é—® [GitHub ä»“åº“](https://github.com/your-org/hydro-ai-helper)ã€‚

è¯¦ç»†çš„å¼€å‘æ–‡æ¡£è¯·å‚è€ƒ [`.specify/specs/ai-learning-assistant/`](./.specify/specs/ai-learning-assistant/) ç›®å½•ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0.0
**æœ€åæ›´æ–°**ï¼š2025-11-18
**ç»´æŠ¤è€…**ï¼šHydroOJ AI å­¦ä¹ åŠ©æ‰‹å¼€å‘å›¢é˜Ÿ
